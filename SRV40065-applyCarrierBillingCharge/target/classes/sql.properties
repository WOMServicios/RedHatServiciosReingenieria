sql.getdatosfacturacion = SELECT customer_all.cscomptaxno AS rut, customer_all.customer_id, nvl(customer_all.CUSTOMER_ID_HIGH,customer_all.customer_id)  as CUSTOMER_ID_HIGH, contract_all.co_id AS contract_id, directory_number.dn_num AS num_celular, DECODE( rateplan_to_rateplan_type.rateplan_type_id , '1','Postpaid','2','Control', '4','Postpaid','3','Prepaid' , '6','Prepaid' , '5', 'Control','Postpaid' ) AS tipo_contrato, rateplan.shdes AS ratePlan, ROUND(ROUND(sysdate - contract_all.CO_ACTIVATED)/30) AS antiguedad, billcycle_actual_view.billcycle AS ciclo, contract_all.ch_status AS estado_contrato, contract_all.co_activated AS fecha_activacion, decode(sign(instr(rateplan.des,'Empresa')),1,'Empresa',decode(sign(instr(rateplan.des,'Business')),1,'Empresa','Persona')) AS MERCADO, sum(ROUND(mpulktmb.accessfee*1.19,0)) as cargo_basico FROM directory_number, contr_services_cap, contract_all, ccontact_all, contr_devices, sysadm.rateplan, rateplan_to_rateplan_type, customer_all, billcycle_definition,  billcycle_actual_view, reasonstatus_all, contract_history, mpulktmb, mpusntab, mpusptab WHERE directory_number.dn_id = contr_services_cap.dn_id AND directory_number.dn_num = '${headers.msisdn}' AND contr_services_cap.co_id = contract_all.co_id AND contract_all.customer_id = ccontact_all.customer_id AND contr_devices.co_id = contract_all.co_id AND CONTRACT_HISTORY.co_id = contract_all.co_id AND CONTRACT_HISTORY.CH_REASON= REASONSTATUS_ALL.RS_ID AND CONTRACT_HISTORY.ch_seqno = (select max(x.ch_seqno) from CONTRACT_HISTORY x where x.co_id = CONTRACT_HISTORY.co_id) AND contract_all.tmcode = rateplan.TMCODE AND rateplan.tmcode = rateplan_to_rateplan_type.tmcode AND mpulktmb.tmcode = rateplan.tmcode AND mpulktmb.sncode = mpusntab.sncode AND mpulktmb.spcode = mpusptab.spcode AND mpulktmb.csind='X' AND mpulktmb.sncode in (3,551) AND contract_all.customer_id = customer_all.customer_id AND ccontact_all.customer_id = customer_all.customer_id AND billcycle_actual_view.customer_id = customer_all.customer_id AND billcycle_actual_view.billcycle = BILLCYCLE_DEFINITION.billcycle AND contr_services_cap.sncode = 3 AND ccontact_all.ccbill = 'X' AND REASONSTATUS_ALL.REASON_SCOPE = 'C' AND contr_services_cap.cs_deactiv_date IS NULL AND contr_devices.cd_deactiv_date IS NULL GROUP BY customer_all.cscomptaxno, BILLCYCLE_DEFINITION.LAST_RUN_DATE, BILLCYCLE_DEFINITION.BCH_RUN_DATE-1 , customer_all.customer_id, customer_all.CUSTOMER_ID_HIGH, contract_all.co_id, directory_number.dn_num, DECODE( rateplan_to_rateplan_type.rateplan_type_id , '1','Postpaid','2','Control', '4','Postpaid','3','Prepaid' , '6','Prepaid' , '5', 'Control','Postpaid' ), customer_all.custcode, rateplan.tmcode, ROUND(ROUND(sysdate - contract_all.CO_ACTIVATED)/30), billcycle_actual_view.billcycle, rateplan.shdes, contract_all.ch_status, contract_all.co_activated, rateplan.des, decode(sign(instr(rateplan.des,'Empresa')),1,'Empresa',decode(sign(instr(rateplan.des,'Business')),1,'Empresa','Persona'))  
